# すくすくミントちゃん 開発環境構築手順書

## 📋 概要
Raspberry Pi 5でのスマートプランター開発環境構築手順

## 🛠️ 必要な環境

### ハードウェア
- Raspberry Pi 5 (4GB以上推奨)
- microSDカード (32GB以上、Class 10以上)
- USBストレージ (16GB以上)
- 温湿度センサー AHT25
- 土壌水分センサー SEN0193
- その他センサー類

### ソフトウェア
- Raspberry Pi OS (64-bit) - Bookworm
- Python 3.11.x
- Flask 2.3.3

## 🔧 構築手順

### 1. Raspberry Pi OS インストール

```bash
# Raspberry Pi ImagerでOSを書き込み
# 設定項目:
# - SSH有効化
# - ユーザー名: pi
# - パスワード: [設定]
# - Wi-Fi設定: [自宅のWi-Fi]
```

### 2. システム更新

```bash
sudo apt update
sudo apt upgrade -y
sudo apt install -y python3-pip python3-venv
```

### 3. Python環境構築

```bash
# 仮想環境作成
python3 -m venv smart-planter-env
source smart-planter-env/bin/activate

# 必要なライブラリインストール
pip install Flask==2.3.3
pip install RPi.GPIO
pip install requests
pip install Pillow
pip install numpy
pip install opencv-python
```

### 4. 固定IP設定

```bash
# DHCP設定ファイル編集
sudo nano /etc/dhcpcd.conf

# 以下を追加
interface wlan0
static ip_address=192.168.1.100/24
static routers=192.168.1.1
static domain_name_servers=192.168.1.1 8.8.8.8

# 設定反映
sudo systemctl restart dhcpcd
```

### 5. mDNS設定（オプション）

```bash
# avahi-daemonインストール
sudo apt install avahi-daemon

# ホスト名設定
sudo nano /etc/hostname
# 内容: smart-planter

# 再起動
sudo reboot
```

### 6. USBストレージ設定

```bash
# USBストレージをマウント
sudo mkdir /mnt/usb-storage
sudo mount /dev/sda1 /mnt/usb-storage

# 自動マウント設定
echo '/dev/sda1 /mnt/usb-storage ext4 defaults 0 2' | sudo tee -a /etc/fstab
```

### 7. プロジェクトディレクトリ作成

```bash
mkdir -p /home/pi/smart-planter
cd /home/pi/smart-planter

# ディレクトリ構造作成
mkdir -p {src,data,logs,images,config}
```

## 🚀 起動確認

### 1. Flask起動テスト

```bash
cd /home/pi/smart-planter
source smart-planter-env/bin/activate

# テスト用Flaskアプリ作成
cat > test_app.py << EOF
from flask import Flask
import socket

app = Flask(__name__)

@app.route('/')
def home():
    return f"""
    <h1>🌱 すくすくミントちゃん</h1>
    <p>システム起動中...</p>
    <p>IP: {socket.gethostbyname(socket.gethostname())}</p>
    """

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
EOF

python test_app.py
```

### 2. アクセス確認

```
固定IP: http://192.168.1.100:5000
mDNS: http://smart-planter.local:5000
ローカル: http://localhost:5000
```

## 🔧 トラブルシューティング

### IPアドレス確認
```bash
# 現在のIPアドレス確認
ip addr show wlan0

# ネットワーク接続確認
ping 8.8.8.8
```

### Flask起動エラー
```bash
# ポート使用状況確認
sudo netstat -tlnp | grep :5000

# プロセス終了
sudo kill -9 [PID]
```

### センサー接続確認
```bash
# GPIO確認
sudo raspi-config
# Interface Options > I2C > Enable
# Interface Options > SPI > Enable
```

## 📱 開発用アクセス方法

### 推奨アクセス方法
1. **固定IP**: `http://192.168.1.100:5000`
2. **mDNS**: `http://smart-planter.local:5000`
3. **動的IP検出**: 起動時に表示されるIPアドレス

### 開発時の注意点
- デバッグモードは本番環境では無効化
- ログファイルはUSBストレージに保存
- 定期的なバックアップを実施

## 🔄 自動起動設定

```bash
# systemdサービス作成
sudo nano /etc/systemd/system/smart-planter.service

# 内容:
[Unit]
Description=Smart Planter Flask App
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/smart-planter
Environment=PATH=/home/pi/smart-planter/smart-planter-env/bin
ExecStart=/home/pi/smart-planter/smart-planter-env/bin/python src/app.py
Restart=always

[Install]
WantedBy=multi-user.target

# サービス有効化
sudo systemctl enable smart-planter.service
sudo systemctl start smart-planter.service
```

## 📊 環境確認チェックリスト

- [ ] Raspberry Pi OS インストール完了
- [ ] Python 3.11.x インストール完了
- [ ] Flask 2.3.3 インストール完了
- [ ] 固定IP設定完了
- [ ] USBストレージマウント完了
- [ ] GPIO有効化完了
- [ ] Flask起動テスト完了
- [ ] アクセス確認完了
- [ ] 自動起動設定完了

## 🎯 次のステップ

1. センサー接続テスト
2. データベース設計
3. Web UI実装
4. LINE通知機能実装
5. 統合テスト

---

**作成日**: 2025年1月
**バージョン**: 1.0
**チーム**: KEBABS
