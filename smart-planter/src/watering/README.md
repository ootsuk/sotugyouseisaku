# 自動給水機能 実装手順書

## 📋 概要
土壌水分センサーの値に基づいて自動で水やりを行う機能の詳細実装手順書

## 🎯 実装目標
- 土壌水分値159以下での自動給水判定
- 前回給水から12時間経過の確認
- リレーモジュールによる水ポンプ制御
- 安全機能（連続給水防止、水タンク空検知）
- 給水履歴の記録と通知

## 🛠️ 必要な環境

### ハードウェア
- Raspberry Pi 5
- リレーモジュール AE-G5V-DRV
- 水中ポンプ（12V DC）
- 外部電源（ポンプ用）
- 水タンク
- 配管・ホース

### ソフトウェア
- Python 3.11.x
- RPi.GPIO
- センサー制御システム（前回実装）
- LINE通知システム

## 🔧 実装手順

### Step 1: ハードウェア接続

#### 1.1 リレーモジュール接続
```python
# GPIOピン定義
GPIO_PINS = {
    'RELAY_PUMP': 16,    # GPIO 16 (Pin 36) - ポンプ制御
    'RELAY_LED': 20,     # GPIO 20 (Pin 38) - LED制御（将来用）
}
```

#### 1.2 配線図
```
リレーモジュール AE-G5V-DRV:
- VCC → 5V (Pin 2)
- GND → GND (Pin 6)
- IN1 → GPIO 16 (Pin 36) - ポンプ制御
- IN2 → GPIO 20 (Pin 38) - LED制御（将来用）

水中ポンプ:
- 正極 → リレーモジュール NO1
- 負極 → リレーモジュール COM1
- 電源 → 外部12V電源

外部電源:
- 12V電源アダプター
- リレーモジュール VCC/GND接続
```

#### 1.3 安全回路
```
安全機能:
1. フロートスイッチによる水タンク空検知
2. 連続給水回数制限（最大2回）
3. 給水時間制限（最大5秒）
4. 緊急停止機能
```

## 📊 実装完了チェックリスト

- [ ] ハードウェア接続完了
- [ ] リレーモジュール接続完了
- [ ] 給水制御クラス実装完了
- [ ] 自動給水マネージャー実装完了
- [ ] Web API実装完了
- [ ] テストスクリプト実行完了
- [ ] 安全機能確認完了
- [ ] 給水履歴機能確認完了
- [ ] LINE通知統合完了
- [ ] エラーハンドリング確認完了

## 🎯 次のステップ

1. **Web UI実装**: 給水制御のWebインターフェース
2. **データ可視化**: 給水履歴のグラフ表示
3. **設定画面**: 給水パラメータの動的変更
4. **統合テスト**: 全システムの動作確認

---

**作成日**: 2025年1月
**バージョン**: 1.0
**チーム**: KEBABS

